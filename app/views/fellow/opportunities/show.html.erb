<h1><%= @candidate.opportunity.formatted_name %></h1>

<table class="opportunity-stages">
  <thead>
    <th class="phase">Phase</th>
    <th class="recommended-action">Recommended Action</th>
  </thead>
  
  <tbody>
    <% ['Apply', 'Interview', 'Offer'].each do |phase| %>
      <% phase_content = @content.select{|k,v| v['phase'] == phase} %>
      <% stage_counter = 0 %>
      <tr>
        <td class="phase" rowspan="<%= phase_content.size %>"><%= phase %></td>
          <% phase_content.each do |stage_name, content| %>
            <% if stage_name == @candidate.stage # Active Stage %>
              <td class="active-stage">
                <h3><%= content['phase_position'] %>. <%= content['title'] %></h3>
          
                <% if content['links'] %>
                  <h4 class="question"><%= interpolate(content['question']) %></h4>     
                  <ul class="response-links">
                    <% content['links'].each do |update, label| %>
                      <li><%= link_to_status_update update, label %></li>
                    <% end %>
                  </ul>
                <% end %>
              
                <% if content['tips'] %>
                  <h4 class="tips-toggle">How to do this like a pro</h4>
                  <div class="tips">
                    <% if content['tips']['header'] %>
                      <p><%= interpolate(content['tips']['header']) %></p>
                    <% end %>
                    <% if content['tips']['list'] %>
                      <ul>
                        <% content['tips']['list'].each do |tip| %>
                          <li><%= interpolate(tip) %></li>
                        <% end %>
                      </ul>
                    <% end %>
                  </div>
                <% end %>
                      
              </td>

            <% else # Not the active Stage %>
              <td><%= content['phase_position'] %>. <%= content['title'] %></td>
            <% end %>
          
        </tr>
        <tr>

          <% end %>
        </tr>
    <% end %>
  </tbody>
</table>
